name: Main Commit Notification

on:
  push:
    branches: [ main ]

jobs:
  notify-main-commit:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 2
      - name: Get commit info
        id: commit-info
        run: |
          echo "commit_message=$(git log -1 --pretty=format:'%s')" >> $GITHUB_OUTPUT
          echo "commit_author=$(git log -1 --pretty=format:'%an')" >> $GITHUB_OUTPUT
          echo "commit_date=$(git log -1 --pretty=format:'%cd' --date=short)" >> $GITHUB_OUTPUT
          echo "files_changed=$(git diff --name-only HEAD~1 HEAD | wc -l)" >> $GITHUB_OUTPUT
      - name: Discord Notification - Commit to Main
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
        with:
          args: |
            ğŸš¨ **Novo commit na branch main!**
            
            **RepositÃ³rio:** ${{ github.repository }}
            **Autor:** ${{ steps.commit-info.outputs.commit_author }}
            **Data:** ${{ steps.commit-info.outputs.commit_date }}
            
            **Mensagem do commit:**
            `${{ steps.commit-info.outputs.commit_message }}`
            
            ğŸ“ **Hash:** `${{ github.sha }}`
            ğŸ“¦ **Arquivos alterados:** ${{ steps.commit-info.outputs.files_changed }}
            
            ğŸ”— [Ver commit](${{ github.server_url }}/${{ github.repository }}/commit/${{ github.sha }})